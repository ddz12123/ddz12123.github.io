"use strict";(globalThis.webpackChunkfontend_doc=globalThis.webpackChunkfontend_doc||[]).push([[9149],{6447:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>o,contentTitle:()=>s,default:()=>d,frontMatter:()=>p,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"\u524d\u7aef\u77e5\u8bc6\u5e93/Uniapp/uni-app\u9274\u6743","title":"uni-app \u9274\u6743","description":"auth.js","source":"@site/docs/\u524d\u7aef\u77e5\u8bc6\u5e93/Uniapp/uni-app\u9274\u6743.md","sourceDirName":"\u524d\u7aef\u77e5\u8bc6\u5e93/Uniapp","slug":"/\u524d\u7aef\u77e5\u8bc6\u5e93/Uniapp/uni-app\u9274\u6743","permalink":"/docs/\u524d\u7aef\u77e5\u8bc6\u5e93/Uniapp/uni-app\u9274\u6743","draft":false,"unlisted":false,"editUrl":"https://github.com/ddz12123/ddz12123.github.io/tree/main/docs/\u524d\u7aef\u77e5\u8bc6\u5e93/Uniapp/uni-app\u9274\u6743.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Uniapp \u5957\u58f3h5\u6253\u5305app","permalink":"/docs/\u524d\u7aef\u77e5\u8bc6\u5e93/Uniapp/Uniapp \u5957\u58f3h5\u6253\u5305app"},"next":{"title":"uniapp \u5e38\u7528UI\u7ec4\u4ef6\u5e93","permalink":"/docs/\u524d\u7aef\u77e5\u8bc6\u5e93/Uniapp/uniapp \u5e38\u7528UI\u7ec4\u4ef6\u5e93"}}');var a=r(7259),i=r(9087);const p={},s="uni-app \u9274\u6743",o={},c=[{value:"auth.js",id:"authjs",level:2},{value:"\u5728 main.js \u91cc\u6ce8\u518c\u5168\u5c40 mixin",id:"\u5728-mainjs-\u91cc\u6ce8\u518c\u5168\u5c40-mixin",level:2}];function u(n){const e={code:"code",h1:"h1",h2:"h2",header:"header",pre:"pre",...(0,i.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"uni-app-\u9274\u6743",children:"uni-app \u9274\u6743"})}),"\n",(0,a.jsx)(e.h2,{id:"authjs",children:"auth.js"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-javascript",children:"// utils/auth.js\r\nconst whiteList = [\r\n  '/pages/login/login',\r\n  '/pages/about/about',\r\n]\r\n\r\nexport function checkAuth(pagePath) {\r\n  const token = uni.getStorageSync('token')\r\n  if (!token && !whiteList.includes(pagePath)) {\r\n    // \u672a\u767b\u5f55\u4e14\u4e0d\u5728\u767d\u540d\u5355\r\n    uni.redirectTo({\r\n      url: '/pages/login/login'\r\n    })\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u5728-mainjs-\u91cc\u6ce8\u518c\u5168\u5c40-mixin",children:"\u5728 main.js \u91cc\u6ce8\u518c\u5168\u5c40 mixin"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-js",children:"// main.js\r\nimport { createSSRApp } from 'vue'\r\nimport App from './App.vue'\r\nimport { checkAuth } from '@/utils/auth.js'\r\n\r\nexport function createApp() {\r\n  const app = createSSRApp(App)\r\n\r\n  // \u5168\u5c40\u9875\u9762\u9274\u6743 mixin\r\n  app.mixin({\r\n    onShow() {\r\n      // #ifdef H5\r\n      const pages = getCurrentPages()\r\n      const currentPage = pages[pages.length - 1]\r\n      const path = '/' + currentPage.route\r\n      checkAuth(path)\r\n      // #endif\r\n\r\n      // #ifndef H5\r\n      const pages = getCurrentPages()\r\n      const currentPage = pages[pages.length - 1]\r\n      const path = '/' + currentPage.route\r\n      checkAuth(path)\r\n      // #endif\r\n    }\r\n  })\r\n\r\n  return { app }\r\n}\r\n\n"})})]})}function d(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(u,{...n})}):u(n)}},9087:(n,e,r)=>{r.d(e,{R:()=>p,x:()=>s});var t=r(6363);const a={},i=t.createContext(a);function p(n){const e=t.useContext(i);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:p(n.components),t.createElement(i.Provider,{value:e},n.children)}}}]);