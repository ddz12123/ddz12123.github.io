# CSS 选择器及优先级详解

## CSS 选择器类型

### 1. 基础选择器

#### 元素选择器
```css
/* 选择所有 <p> 元素 */
p {
  color: blue;
}

/* 选择所有 <div> 元素 */
div {
  margin: 10px;
}
```

#### 类选择器
```css
/* 选择所有 class="button" 的元素 */
.button {
  background: #f0f0f0;
}

/* 选择同时有 primary 和 large 类的元素 */
.primary.large {
  font-size: 18px;
}
```

#### ID 选择器
```css
/* 选择 id="header" 的元素 */
#header {
  height: 60px;
}

/* 选择 id="main-content" 的元素 */
#main-content {
  width: 80%;
}
```

#### 通用选择器
```css
/* 选择所有元素 */
* {
  box-sizing: border-box;
}

/* 选择 div 内的所有元素 */
div * {
  margin: 5px;
}
```

### 2. 属性选择器

```css
/* 选择有 title 属性的元素 */
[title] {
  border: 1px solid gray;
}

/* 选择 type="text" 的输入框 */
input[type="text"] {
  border: 1px solid #ccc;
}

/* 选择 href 以 "https" 开头的链接 */
a[href^="https"] {
  color: green;
}

/* 选择 src 以 ".jpg" 结尾的图片 */
img[src$=".jpg"] {
  border: 2px solid red;
}

/* 选择 class 包含 "btn" 的元素 */
[class*="btn"] {
  cursor: pointer;
}
```

### 3. 组合选择器

#### 后代选择器
```css
/* 选择 article 内所有的 p 元素 */
article p {
  line-height: 1.6;
}

/* 选择 .container 内所有的 .item */
.container .item {
  padding: 10px;
}
```

#### 子选择器
```css
/* 只选择 nav 的直接子元素 li */
nav > li {
  display: inline-block;
}

/* 只选择 .menu 的直接子元素 .item */
.menu > .item {
  border-bottom: 1px solid #eee;
}
```

#### 相邻兄弟选择器
```css
/* 选择紧接在 h1 后面的 p 元素 */
h1 + p {
  margin-top: 0;
  font-weight: bold;
}

/* 选择紧接在 .alert 后面的 .button */
.alert + .button {
  margin-left: 10px;
}
```

#### 通用兄弟选择器
```css
/* 选择 h2 后面所有的 p 兄弟元素 */
h2 ~ p {
  color: #666;
}

/* 选择 .selected 后面所有的 .item */
.selected ~ .item {
  opacity: 0.5;
}
```

### 4. 伪类选择器

#### 状态伪类
```css
/* 链接状态 */
a:link { color: blue; }      /* 未访问的链接 */
a:visited { color: purple; } /* 已访问的链接 */
a:hover { color: red; }      /* 鼠标悬停 */
a:active { color: green; }   /* 激活状态 */

/* 表单状态 */
input:focus {
  outline: 2px solid blue;
}

input:disabled {
  background-color: #f0f0f0;
}

input:checked {
  background-color: green;
}
```

#### 结构伪类
```css
/* 选择第一个子元素 */
li:first-child {
  font-weight: bold;
}

/* 选择最后一个子元素 */
li:last-child {
  border-bottom: none;
}

/* 选择第 n 个子元素 */
li:nth-child(2) {
  color: red;
}

/* 选择奇数子元素 */
tr:nth-child(odd) {
  background-color: #f9f9f9;
}

/* 选择偶数子元素 */
tr:nth-child(even) {
  background-color: #fff;
}

/* 选择没有特定类的元素 */
div:not(.exclude) {
  display: block;
}
```

### 5. 伪元素选择器
```css
/* 在元素内容前插入 */
p::before {
  content: "→ ";
  color: gray;
}

/* 在元素内容后插入 */
p::after {
  content: " ←";
  color: gray;
}

/* 选择第一行 */
p::first-line {
  font-weight: bold;
}

/* 选择第一个字母 */
p::first-letter {
  font-size: 2em;
  float: left;
}

/* 选择用户选中的文本 */
::selection {
  background: yellow;
  color: black;
}
```

## CSS 选择器优先级

### 优先级计算规则

优先级由四个部分组成，格式为：`[a,b,c,d]`

- **a**: 是否使用 `!important`
- **b**: ID 选择器的数量
- **c**: 类选择器、属性选择器、伪类的数量
- **d**: 元素选择器、伪元素选择器的数量

### 优先级示例

```css
/* 优先级: [0,0,0,1] - 0001 */
p {
  color: black;
}

/* 优先级: [0,0,1,0] - 0010 */
.class {
  color: blue;
}

/* 优先级: [0,1,0,0] - 0100 */
#id {
  color: green;
}

/* 优先级: [0,0,1,1] - 0011 */
div.class {
  color: yellow;
}

/* 优先级: [0,0,2,1] - 0021 */
div.class1.class2 {
  color: orange;
}

/* 优先级: [0,1,1,1] - 0111 */
div#id.class {
  color: purple;
}

/* 优先级: [0,1,0,1] - 0101 */
div#id {
  color: pink;
}
```

### 优先级比较规则

```css
/* 示例1: ID 选择器胜出 */
#content { color: red; }      /* 0100 - 胜出 */
div.content { color: blue; }  /* 0011 */

/* 示例2: 类选择器数量多的胜出 */
.container .item .title { color: red; }  /* 0030 - 胜出 */
#content .title { color: blue; }         /* 0110 */

/* 示例3: 相同优先级时，后面的样式胜出 */
p { color: black; }
p { color: red; }  /* 这个生效 */

/* 示例4: !important 最高优先级 */
p { 
  color: red !important;  /* 这个生效，优先级最高 */
}
#special p { 
  color: blue; 
}
```

### 特殊规则

#### 1. !important
```css
.button {
  color: blue !important;  /* 最高优先级 */
}

#special .button {
  color: red;  /* 不会覆盖上面的样式 */
}
```

#### 2. 内联样式
```html
<!-- 内联样式优先级仅次于 !important -->
<div style="color: red;">这个颜色是红色</div>
```

```css
/* 即使有 ID 选择器也无法覆盖内联样式 */
#my-div {
  color: blue;  /* 不会生效 */
}
```

#### 3. 继承的样式
```css
/* 继承的样式优先级最低 */
body {
  color: black;  /* 这个颜色会被继承 */
}

div {
  color: red;  /* 但会被这个覆盖 */
}
```

### 优先级实战示例

```html
<div id="container" class="main">
  <ul class="list">
    <li class="item active">项目1</li>
    <li class="item">项目2</li>
    <li class="item special">项目3</li>
  </ul>
</div>
```

```css
/* 优先级: [0,0,0,2] - 0002 */
ul li {
  color: gray;
}

/* 优先级: [0,0,1,1] - 0011 */
.list .item {
  color: blue;
}

/* 优先级: [0,0,2,0] - 0020 */
.item.active {
  color: green;
}

/* 优先级: [0,0,2,1] - 0021 */
ul .item.special {
  color: orange;
}

/* 优先级: [0,1,1,1] - 0111 */
#container .list .item {
  color: purple;  /* 这个生效 */
}

/* 优先级: [0,1,2,1] - 0121 */
#container ul .item.special {
  color: red !important;  /* 这个生效，因为 !important */
}
```

### 避免优先级问题的最佳实践

#### 1. 保持低优先级
```css
/* 推荐：使用类选择器，保持低优先级 */
.button { }
.button-primary { }
.button-large { }

/* 不推荐：过度使用 ID 选择器 */
#submit-button { }
```

#### 2. 避免过度嵌套
```css
/* 不推荐：过度嵌套 */
#header .nav .menu .item .link { }

/* 推荐：保持简洁 */
.nav-link { }
```

#### 3. 合理使用 !important
```css
/* 只在真正需要时使用 !important */
.utility-class {
  display: block !important;  /* 工具类可以使用 */
}

/* 避免在常规样式中使用 */
.regular-class {
  color: red;  /* 不要轻易使用 !important */
}
```

### 优先级总结表

| 选择器类型   | 示例                    | 优先级值 |
| ------------ | ----------------------- | -------- |
| 元素选择器   | `p`, `div`              | 0001     |
| 伪元素       | `::before`, `::after`   | 0001     |
| 类选择器     | `.class`                | 0010     |
| 属性选择器   | `[type="text"]`         | 0010     |
| 伪类         | `:hover`, `:focus`      | 0010     |
| ID 选择器    | `#id`                   | 0100     |
| 内联样式     | `style="..."`           | 1000     |
| `!important` | `color: red !important` | 最高     |

理解 CSS 选择器和优先级对于编写可维护的 CSS 代码至关重要。建议尽量使用类选择器，避免过度嵌套和滥用 `!important`。