# uniapp 请求封装

## 1. 简易版本

### 1.1 utils/request.js

```js
// utils/request.js

const BASE_URL = 'https://example.com/api'; // 你的接口基础路径

// 拦截器配置
const interceptors = {
  // 请求拦截
  request(config) {
    // 例如：添加 token
    const token = uni.getStorageSync('token');
    if (token) {
      config.header = {
        ...config.header,
        Authorization: `Bearer ${token}`,
      };
    }
    return config;
  },

  // 响应拦截
  response(response) {
    // 可以在这里做统一错误处理
    const { statusCode, data } = response;
    if (statusCode >= 200 && statusCode < 300) {
      return data;
    } else {
      uni.showToast({
        title: data?.message || '请求错误',
        icon: 'none',
      });
      return Promise.reject(data);
    }
  },

  // 错误拦截（网络错误、超时等）
  error(error) {
    uni.showToast({
      title: '网络异常，请稍后再试',
      icon: 'none',
    });
    return Promise.reject(error);
  },
};

// 通用请求封装
function request(options) {
  const config = interceptors.request({
    url: BASE_URL + options.url,
    method: options.method || 'GET',
    data: options.data || {},
    header: options.header || {},
    timeout: options.timeout || 10000,
  });

  return new Promise((resolve, reject) => {
    uni.request({
      ...config,
      success: (res) => {
        try {
          const data = interceptors.response(res);
          resolve(data);
        } catch (err) {
          reject(err);
        }
      },
      fail: (err) => {
        interceptors.error(err);
        reject(err);
      },
    });
  });
}

// 常用 CRUD 封装
const http = {
  get(url, params = {}, config = {}) {
    return request({ url, method: 'GET', data: params, ...config });
  },

  post(url, data = {}, config = {}) {
    return request({ url, method: 'POST', data, ...config });
  },

  put(url, data = {}, config = {}) {
    return request({ url, method: 'PUT', data, ...config });
  },

  delete(url, data = {}, config = {}) {
    return request({ url, method: 'DELETE', data, ...config });
  },
};

export default http;

```

## 2. 使用示例

### 2.1 在页面中使用
```js
// 在任意页面或模块中使用
import http from '@/utils/request.js';

async function loadData() {
  try {
    const res = await http.get('/user/list', { page: 1 });
    console.log('用户列表：', res);
  } catch (e) {
    console.error('请求失败：', e);
  }
}

```